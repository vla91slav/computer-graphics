<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Лабораторная работа №2 вариант 7</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/style.css">
</head>
<body>
    <!-- <canvas id="myCanvas" width="800" height="800"></canvas> -->
    <div id="wrapper">
        <button id="zoomin" class="nav" title="Zoom In" onclick="zoomIn()">&#43;</button>
        <button id="zoomout" class="nav" title="Zoom Out" onclick="zoomOut()">&#8722;</button>
        <button id="panup" class="nav" title="Up" onclick="panUp()">&#8679;</button>
        <button id="pandown" class="nav" title="Down" onclick="panDown()">&#8681;</button>
        <button id="panleft" class="nav" title="Left" onclick="panLeft()">&#8678;</button>
        <button id="panright" class="nav" title="Right" onclick="panRight()">&#8680;</button>
      </div>
      <div id="wrapper">
        <canvas id="canvas" width="400" height="400"></canvas>
        <canvas id="canvasX" width="400" height="400"></canvas>
      </div>
    <div><button id="window" hidden>new window</button></div>
</body>
<script>
    require('./js/renderer.js')
</script>
<script>
    var canvas = document.getElementById("canvas")
    var ctx = canvas.getContext("2d")
    var canvas1 = document.getElementById("canvasX")
    var ctxX = canvas1.getContext("2d")

    var cw = canvas.width
    var ch = canvas.height
    var mapW = 200
    var mapH = 200
    var panX = 0
    var panY = 0
    var scaleFactor = 1.00
    let radius = 30

    // drawTranslated()

    function zoomIn() {
        document.getElementById("zoomin").click(); {
            scaleFactor *= 1.1
            drawTranslated()
        }
    }

    function zoomOut() {
        document.getElementById("zoomout").click(); {
            scaleFactor /= 1.1
            drawTranslated()
        }
    }

    function panUp() {
        document.getElementById("panup").click(); {
            panY -= 25
            drawTranslated()
        }
    }

    function panDown() {
        document.getElementById("pandown").click(); {
            panY += 25
            drawTranslated()
        }
    }

    function panLeft() {
        document.getElementById("panleft").click(); {
            panX -= 25
            drawTranslated()
        }
    }

    function panRight() {
        document.getElementById("panright").click(); {
            panX += 25
            drawTranslated()
        }
    }

    function drawTranslated() {
        // canvas
        ctx.clearRect(0, 0, cw, ch)
        ctx.save()
        ctx.translate(cw / 2, ch / 2)
        ctx.scale(scaleFactor, scaleFactor)
        ctx.translate(panX, panY)
        // ctx.fillRect(mapW / -2, mapH / -2, mapW, mapH)

        // фигура
        ctx.beginPath();
        let x = 0
        let y = 0
        const pi = Math.PI
        ctx.arc(x, y, 45, pi/4, pi-pi/4, true) // внутренняя окружность
        ctx.moveTo(x + 50, y)
        ctx.arc(x, y, 50, 0, pi, true) // внешняя окружность
        ctx.moveTo(x - 50, y)
        ctx.lineTo(x - 50, y + 60)
        ctx.lineTo(x + 50, y + 60)
        ctx.lineTo(x + 50, y)

        // хорда
        ctx.moveTo(45 * Math.cos(pi/4), 45 * Math.sin(pi-pi/4))
        ctx.lineTo(x - 45 * Math.cos(pi/4), 45 * Math.sin(pi-pi/4))

        // треугольник
        ctx.moveTo(x + 45, y + 55)
        ctx.lineTo(x + 25, y + 55)
        ctx.lineTo(x + 45, y + 35)
        ctx.lineTo(x + 45, y + 55)

        // кнопка сверху
        ctx.moveTo(50 * Math.cos(pi/2 - pi/10), 50 * Math.sin(pi + (pi/2 - pi/10)))
        ctx.lineTo(50 * Math.cos(pi/2 - pi/10), 50 * Math.sin(pi + (pi/2 - pi/10)) - 8)
        ctx.lineTo(50 * Math.cos(-pi/2 - pi/10), 50 * Math.sin(pi + (pi/2 - pi/10)) - 8)
        ctx.lineTo(50 * Math.cos(-pi/2 - pi/10), 50 * Math.sin(pi + (pi/2 - pi/10)))

        // подставка
        ctx.moveTo(x - 50, y + 70)
        ctx.lineTo(x + 50, y + 70)
        ctx.lineTo(x + 50, y + 110)
        ctx.lineTo(x - 50, y + 110)
        ctx.lineTo(x - 50, y + 70)

        // текстура подставки
        for (let i = 0; i < 100; i += 4) {
            ctx.moveTo((x - 50) + i, y + 70)
            ctx.lineTo((x - 50) + i, y + 110)
        }
        for (let i = 0.8; i < 16; i *= 2) {
            ctx.moveTo((x - 50) + i, y + 70)
            ctx.lineTo((x - 50) + i, y + 110)
        }
        for (let i = 0.8; i < 16; i *= 2) {
            ctx.moveTo((x + 50) - i, y + 70)
            ctx.lineTo((x + 50) - i, y + 110)
        }

        ctx.moveTo(x - 15, y + 70)
        ctx.lineTo(x - 15, y + 85)
        ctx.lineTo(x + 15, y + 85)
        ctx.lineTo(x + 15, y + 70)
        for (let i = 0; i < 30; i += 3) {
            ctx.moveTo((x - 15) + i, y + 70)
            ctx.lineTo((x - 15) + i, y + 85)
        }

        ctx.moveTo(x - 35, y + 110)
        ctx.lineTo(x - 35, y + 105)
        ctx.lineTo(x + 35, y + 105)
        ctx.lineTo(x + 35, y + 110)
        ctx.stroke() // контур всех проведенных линий

        // стрелки + циферблат
        ctx.clearRect(-radius,-radius,radius*2,radius*2);
        drawMarkers();
        drawHands();

        ctx.restore()

        // // canvasX
        // ctxX.clearRect(0, 0, cw, ch)
        // ctxX.save()
        // ctxX.translate(cw / 2, ch / 2)
        // ctxX.beginPath()

        // ctxX.moveTo(0, 25)
        // ctxX.lineTo(0, -25)
        // ctxX.moveTo(-25, 0)
        // ctxX.lineTo(25, 0)

        // ctxX.closePath()
        // ctxX.lineWidth = 1
        // ctxX.strokeStyle = 'Black'
        // ctxX.stroke()
        // ctxX.restore()
    }

    function drawMarkers() {
        var ang;
        var num;
        ctx.font = radius*0.15 + "px arial";
        ctx.textBaseline = "middle";
        ctx.textAlign = "center";
        for(num = 1; num <= 12; num++){
            ang = num * Math.PI / 6;
            ctx.rotate(ang);
            ctx.translate(0, -radius*0.85);
            ctx.rotate(-ang);
            ctx.fillText(num.toString(), 0, 0);
            ctx.rotate(ang);
            ctx.translate(0, radius*0.85);
            ctx.rotate(-ang);
        }
    }

    function drawHands() {
        var now = new Date();
        var hour = now.getHours();
        var minute = now.getMinutes();
        var second = now.getSeconds();

        // часовая стрелка
        hour = hour % 12;
        hour = (hour * Math.PI / 6) + 
            (minute * Math.PI / (6 * 60)) +
            (second * Math.PI / (360 * 60));
        drawHand(hour, radius*0.5, radius*0.07);

        // минутная стрелка
        minute = (minute * Math.PI / 30) + (second * Math.PI / (30 * 60));
        drawHand(minute, radius*0.8, radius*0.07);

        // секундная стрелка
        second = (second * Math.PI / 30);
        drawHand(second, radius*0.9, radius*0.02);
    }

    // отрисовка стрелок
    function drawHand(pos, length, width) {
        ctx.beginPath();
        ctx.lineWidth = width;
        ctx.lineCap = "round";
        ctx.moveTo(0,0);
        ctx.rotate(pos);
        ctx.lineTo(0, -length);
        ctx.stroke();
        ctx.rotate(-pos);
    }

    setInterval(function() {
        // ctx.clearRect(-radius,-radius,radius*2,radius*2);
        // drawMarkers();
        // drawHands();
        drawTranslated()
    })
</script>
</html>